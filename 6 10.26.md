# 2.3 使用区块链达成没有身份的共识

## 诚实大多数原理

信任基础：算力掌握在大多数用户之中。

诚实链和攻击链的比赛是一个二项分布的随意漫步。诚实链++，赢了一次；攻击链++，输了一次。

> 赌徒破产问题 Gambler's ruin problem(小虫随机游走random walk问题)

赌徒赢的可能性是p，输的可能性是q，开始的资产是z，他对手的资产是a-z，双方有人没钱了停止。

q_z：赌徒破产的可能性
$$
q_z=pq_{z+1}+qq_{z-1}
$$
求特征根blabla，最后求出来
$$
q_z=\frac{(q/p)^z-(q/p)^a}{1-(q/p)^a}
$$
所以在总资产无穷大的话
$$
q_z=(q/p)^z
$$
<img src="C:/Users/16834/Desktop/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%AC%94%E8%AE%B0/IMG_20211026_083025_edit_112729868892693.jpg" alt="IMG_20211026_083025_edit_112729868892693" style="zoom:8.5%;" />

如果q>p，一定会追上，如果q<p，有可能会追上(q/p)^z^

在发展到第z个区块的时候（第z时间出z个块），建立概率模型：

<img src="C:/Users/16834/Desktop/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%AC%94%E8%AE%B0/IMG_20211026_083212_edit_112878677342149.jpg" alt="IMG_20211026_083212_edit_112878677342149" style="zoom: 25%;" />

在z=6的时候，攻击成功的概率下降到0.0002428

# 2.4 奖励机制和工作量证明

## 2.4.1 区块奖励

创建区块的节点可以在这个区块中加入一笔特别的交易。这笔交易就是一个 **造币的交易**。这是新比特币被允许创造出来的唯一途径，没有任何其他新增币的机制。

### Subtle but powerful trick

造币交易和其他每一笔交易一样，只有当它最终被纳入共识链，才会被其他节点接受。

最后比特币的上限是2100 0000。
$$
210000\times (50)\frac{1-(1/2)^n}{1-1/2}=2100 0000 \times (1-(1/2)^n)
$$

## 2.4.2 交易费

代码小，会被优先打包。

## 2.4.3 Challenges

- how to choose node randomly?

  the people to store your transaction can not be predicted

- 都来抢奖励，系统是不是会不稳定

- Sybil Attack，女巫攻击

### 工作量证明

随机节点X  节点所占有的资源√

bitcoin看的是算力的竞争，怎么竞争？哈希函数谜题，看谁先解出来nonce。如果一个节点发现一个nonce就可以提议创建下一个区块

> 笑死比特币推进哈希函数的研究

### 可参数化成本

根据某个区域上2016个区块（约2week）的平均出块时间，调整这个地方的难度，期望是10分钟出块。


中心化与去中心化的**混合**：弱中心化

区块链要解决的三个问题：decentralize, security, scalability

- decentralize, scalability: P2P 比如迅雷，但是不安全
- security, scalability: 中心化的银行管理系统

# 去中心化解决的问题

6点

- 谁记账scrooge，财迷本人记账，这是中心化的。

# 分布式共识

- 证明自己花了这笔钱：签名然后广播
- 希望有效的交易迅速被写进区块链

困难：

- 达成共识难：节点宕机、恶意节点
- 点对点通信
- 信息传递延迟

不可能性结论：Byzantine Generals Problem，拜占庭将军问题（==里面有没有叛徒，大家是不是都是可信的==）

- 将军n，叛徒t，只要n>3t就可以容错。
- 3个人里一个是叛徒，就没办法判断谁是叛徒，所以需要大于3。1将军2中士场景

> 比特币实际的运行情况远比理论的研究结果好得多。
> 引入了奖励的机制
> 随着时间推移，观点分歧的概率会指数下降

当前区块包含前一个区块的hash（在接受别人的区块之前要验证是不是对的，否则你在那里挖，结果别人发现这人的区块是错的，你就浪费算力了，所以人们会自觉维护链条的正确性。）

**比特币共识算法**

## 比特币攻击

- 窃取比特币->伪造数字签名

- 拒绝服务攻击->张三给李四转了钱，李四拒绝提供服务，说没收钱。但没关系，别人知道。因为李四收钱的时候会提供自己的签名和公钥。

- **双重支付攻击** double spending attack

  李四给张三转钱，又给别人转了这笔钱。

  到底怎么算，看哪个交易被包含在更长的区块链，double-spend attempt就失败了。所以需要wait一些延时才能确认是否有效。

# chapter 3 比特币脚本

public ledger

不是基于账户余额的模式，账户余额是依赖于之前的交易的，在支出之前需要前面的也被确认，但可能还没确认呢。**延时确认**

比特币不需要身份绑定，公钥就是身份

> 公钥账户，私钥密码？

scriptPubKey是说，我要把钱转到这个公钥地址里，并且给了一系列解锁条件。

scriptSig是说，我提供我的公钥和签名来领钱（解锁这个交易）

```
<sig><pubkey> OP_DUP OP_HASH160 <pubkeyhash> OP_EQUALVARIFY OP_CHECKSIG
```

![image-20211019093520517](C:/Users/16834/Desktop/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%AC%94%E8%AE%B0/image-20211019093520517.png)意思是先把sig压栈，再压公钥，再复制堆栈顶部，再对它（公钥）哈希，然后把pubkeyhash压栈，在比较这俩，最后检查签名。

https://medium.com/@raksha.p82/a-note-on-bitcoin-transaction-scripts-f04d298f1855

















